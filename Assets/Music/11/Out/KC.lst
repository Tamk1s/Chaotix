                        	LIST MACRO
                        	LIST EXPAND
000000                  	include _s1smps2asm_S1KC.asm
                        ; Standard Octave Pitch Equates
       = 000088         smpsPitch10lo		EQU	$88
       = 000094         smpsPitch09lo		EQU	$94
       = 0000A0         smpsPitch08lo		EQU	$A0
       = 0000AC         smpsPitch07lo		EQU	$AC
       = 0000B8         smpsPitch06lo		EQU	$B8
       = 0000C4         smpsPitch05lo		EQU	$C4
       = 0000D0         smpsPitch04lo		EQU	$D0
       = 0000DC         smpsPitch03lo		EQU	$DC
       = 0000E8         smpsPitch02lo		EQU	$E8
       = 0000F4         smpsPitch01lo		EQU	$F4
       = 000000         smpsPitch00			EQU	$00
       = 00000C         smpsPitch01hi		EQU	$0C
       = 000018         smpsPitch02hi		EQU	$18
       = 000024         smpsPitch03hi		EQU	$24
       = 000030         smpsPitch04hi		EQU	$30
       = 00003C         smpsPitch05hi		EQU	$3C
       = 000048         smpsPitch06hi		EQU	$48
       = 000054         smpsPitch07hi		EQU	$54
       = 000060         smpsPitch08hi		EQU	$60
       = 00006C         smpsPitch09hi		EQU	$6C
       = 000078         smpsPitch10hi		EQU	$78

                        ; Note Equates
       = 000080         nRst			EQU	$80
       = 000081         nC0			EQU	$81
       = 000082         nCs0			EQU	$82
       = 000083         nD0			EQU	$83
       = 000084         nEb0			EQU	$84
       = 000085         nE0			EQU	$85
       = 000086         nF0			EQU	$86
       = 000087         nFs0			EQU	$87
       = 000088         nG0			EQU	$88
       = 000089         nAb0			EQU	$89
       = 00008A         nA0			EQU	$8A
       = 00008B         nBb0			EQU	$8B
       = 00008C         nB0			EQU	$8C
       = 00008D         nC1			EQU	$8D
       = 00008E         nCs1			EQU	$8E
       = 00008F         nD1			EQU	$8F
       = 000090         nEb1			EQU	$90
       = 000091         nE1			EQU	$91
       = 000092         nF1			EQU	$92
       = 000093         nFs1			EQU	$93
       = 000094         nG1			EQU	$94
       = 000095         nAb1			EQU	$95
       = 000096         nA1			EQU	$96
       = 000097         nBb1			EQU	$97
       = 000098         nB1			EQU	$98
       = 000099         nC2			EQU	$99
       = 00009A         nCs2			EQU	$9A
       = 00009B         nD2			EQU	$9B
       = 00009C         nEb2			EQU	$9C
       = 00009D         nE2			EQU	$9D
       = 00009E         nF2			EQU	$9E
       = 00009F         nFs2			EQU	$9F
       = 0000A0         nG2			EQU	$A0
       = 0000A1         nAb2			EQU	$A1
       = 0000A2         nA2			EQU	$A2
       = 0000A3         nBb2			EQU	$A3
       = 0000A4         nB2			EQU	$A4
       = 0000A5         nC3			EQU	$A5
       = 0000A6         nCs3			EQU	$A6
       = 0000A7         nD3			EQU	$A7
       = 0000A8         nEb3			EQU	$A8
       = 0000A9         nE3			EQU	$A9
       = 0000AA         nF3			EQU	$AA
       = 0000AB         nFs3			EQU	$AB
       = 0000AC         nG3			EQU	$AC
       = 0000AD         nAb3			EQU	$AD
       = 0000AE         nA3			EQU	$AE
       = 0000AF         nBb3			EQU	$AF
       = 0000B0         nB3			EQU	$B0
       = 0000B1         nC4			EQU	$B1
       = 0000B2         nCs4			EQU	$B2
       = 0000B3         nD4			EQU	$B3
       = 0000B4         nEb4			EQU	$B4
       = 0000B5         nE4			EQU	$B5
       = 0000B6         nF4			EQU	$B6
       = 0000B7         nFs4			EQU	$B7
       = 0000B8         nG4			EQU	$B8
       = 0000B9         nAb4			EQU	$B9
       = 0000BA         nA4			EQU	$BA
       = 0000BB         nBb4			EQU	$BB
       = 0000BC         nB4			EQU	$BC
       = 0000BD         nC5			EQU	$BD
       = 0000BE         nCs5			EQU	$BE
       = 0000BF         nD5			EQU	$BF
       = 0000C0         nEb5			EQU	$C0
       = 0000C1         nE5			EQU	$C1
       = 0000C2         nF5			EQU	$C2
       = 0000C3         nFs5			EQU	$C3
       = 0000C4         nG5			EQU	$C4
       = 0000C5         nAb5			EQU	$C5
       = 0000C6         nA5			EQU	$C6
       = 0000C7         nBb5			EQU	$C7
       = 0000C8         nB5			EQU	$C8
       = 0000C9         nC6			EQU	$C9
       = 0000CA         nCs6			EQU	$CA
       = 0000CB         nD6			EQU	$CB
       = 0000CC         nEb6			EQU	$CC
       = 0000CD         nE6			EQU	$CD
       = 0000CE         nF6			EQU	$CE
       = 0000CF         nFs6			EQU	$CF
       = 0000D0         nG6			EQU	$D0
       = 0000D1         nAb6			EQU	$D1
       = 0000D2         nA6			EQU	$D2
       = 0000D3         nBb6			EQU	$D3
       = 0000D4         nB6			EQU	$D4
       = 0000D5         nC7			EQU	$D5
       = 0000D6         nCs7			EQU	$D6
       = 0000D7         nD7			EQU	$D7
       = 0000D8         nEb7			EQU	$D8
       = 0000D9         nE7			EQU	$D9
       = 0000DA         nF7			EQU	$DA
       = 0000DB         nFs7			EQU	$DB
       = 0000DC         nG7			EQU	$DC
       = 0000DD         nAb7			EQU	$DD
       = 0000DE         nA7			EQU	$DE
       = 0000DF         nBb7			EQU	$DF

                        ; DAC Equates (S1)
       = 000081         dKick			EQU	$81
       = 000082         dSnare			EQU	$82
       = 000083         dTimpani		EQU	$83
       = 000088         dHiTimpani		EQU	$88
       = 000089         dMidTimpani		EQU	$89
       = 00008A         dLowTimpani		EQU	$8A
       = 00008B         dVLowTimpani	EQU	$8B
       = 00008B         dFloorTimpani	EQU $8B

                        ; !@ PSGDelta (S1->KC has 12 semitone increase between PSG)
       = 00000C         PSGDelta	EQU	$0C

                        ; PWM Equates (KC)
       = 000081         pEKick		EQU	$81
       = 000082         pESnare		EQU	$82
       = 000083         pSplashCymb	EQU	$83
       = 000084         pRideBell	EQU $84
       = 000085         pTomHi		EQU	$85
       = 000086         pTomMid		EQU	$86
       = 000087         pTomLow		EQU	$87
       = 000088         pEHiHat		EQU	$88
       = 000089         pCrashCymb	EQU $89
       = 00008A         pClap		EQU $8A
       = 00008B         pAKick		EQU $8B
       = 00008C         pASnare		EQU	$8C
       = 00008D         pBell		EQU $8D
                        ;!@ Enum due to late PWM driver revision
       = 00008E         pFingSnap	EQU	$8E
       = 00008E         pFingSnapHi	EQU	$8E
       = 00008F         pCowbell	EQU	$8F
       = 000090         pClickHi	EQU	$90
       = 000091         pClickLo	EQU	$91
       = 000092         pBongoHi	EQU	$92
       = 000093         pBongoLo	EQU	$93
       = 000094         pTimpaniHi	EQU	$94
       = 000095         pTimpaniLo	EQU	$95
       = 000096         pSilence	EQU $96
                        ;!@ NEW DATA
       = 000097         pSega		EQU $97
       = 000098         pClosedHH	EQU $98
       = 000099         pOpenHH		EQU $99
       = 00009A         pTomLower		EQU	$9A
       = 00009B         pTomLowerer		EQU	$9B
       = 00009C         pTomLowerest	EQU	$9C
       = 00009D         pNepDada		EQU	$9D
       = 00009E         pFingSnapLo		EQU	$9E
       = 00009F         pOrchHitHi		EQU	$9F
       = 0000A0         pOrchHitMed		EQU	$A0
       = 0000A1         pOrchHitLo		EQU	$A1
       = 0000A2         pOrchHitLower	EQU	$A2

                        ;!@ Crackers conversion enums. Knuckles Clackers equiv
       = 000081         pCra_d81	EQU	pEKick
       = 00008C         pCra_d82	EQU	pASnare
       = 000085         pCra_d83	EQU	pTomHi
       = 000086         pCra_d84	EQU	pTomMid
       = 000087         pCra_d85	EQU	pTomLow

                        ;!@ Convert ptrs to z80Ptr
                        ; function to make a little-endian 16-bit pointer for the Z80 sound driver
                        ;z80_ptr function x,y,((((x)|(y))<<8)&$FF00)|((((x)|(y))>>8)&$7F)|$80
                        ;z80_ptr_neg function x,y,((((y)-(x))<<8)&$FF00)|((((y)-(x))>>8)&$7F)|$80

                        ;!@
                        ; macro to declare a little-endian 16-bit pointer for the Z80 sound driver
                        rom_ptr_z80 macro addr
                        	;dc.w z80_ptr(ptr,addr)
                        	dc.w  ((((addr)<<8)&$FF00)|(((addr)>>8)&$7F)|$80)
                            endm
                        	
                        ;Funciton to convert S1 tempo to S2 and then S3+
                        ;The conversion works for all values of main tempo other than 0 â€” this value cannot be converted exactly between the two drivers. The conversion of main tempos from Sonic 1 to Sonic 2 can be done (approximately) with the following formul
                        ;S2 main tempo = floor{ [ (S1 main tempo-1) * 256 + floor(S1 main tempo/2) ] / S1 main tempo }			
                        ;It is easy to convert between Sonic 2 and Sonic 3+ main tempo values:
                        ;S2 main tempo = (256 - S3 main tempo) mod 256
                        ;S3 main tempo = (256 - S2 main tempo) mod 256
                        tempo_conv macro tempo
                        		if tempo==0
                        			dc.b	((256 - (((256-1)*256 + (256/2)) / 256)) % 256)
                        		else
                        			dc.b	((256 - ((((tempo)-1)*256 + ((tempo)/2)) / (tempo))) % 256)
                        		endif
                        	endm
                        	
                        ;!@
                        ; macro to declare a little-endian 16-bit pointer for the Z80 sound driver
                        ;rom_ptr_z80_neg macro ptr,addr
                        	;dc.w z80_ptr_neg(ptr,addr)
                        	;dc.w	(((((addr)-(ptr))<<8)&$FF00)|((((addr)-(ptr))>>8)&$7F)|$80)
                            ;endm

                        ; Header Macros

                        ;!@
                        ; Header - Set up Voice Location
                        ;smpsHeaderVoice macro loc
                        smpsHeaderVoice macro loc,songstart
                        ;songStart set *
                        	;dc.w	loc-songStart
                        	rom_ptr_z80(loc+songstart)
                        	endm
                        ; Header - Set up Channel Usage	
                        smpsHeaderChan macro fm,psg
                        	if \0==2
                        		dc.b	fm,psg
                        	else
                        		dc.b	fm
                        	endif	
                        	endm	
                        	

                        	
                        smpsHeaderTempo macro div,mod
                        	dc.b	div,mod
                        	endm

                        ;!@
                        ; Header - Set up Tempo. Mod is converted from S1 to S3 tempo
                        smpsHeaderTempoC macro div,mod
                        TempDiv set div
                        	dc.b	div
                        	tempo_conv(mod)
000000                  	endm
                        	
                        ; Header - Set up DAC Channel
                        smpsHeaderDAC macro loc
                        	dc.w	loc-songStart
                        	dc.w	$00
                        	endm
                        	
                        ;!@
                        ; Header - Set up FM Channel	
                        ;smpsHeaderFM macro loc,pitch,vol
                        smpsHeaderFM macro loc,songstart,pitch,vol
                        	;dc.w	loc-songStart
                        	rom_ptr_z80(loc+songstart)
                        	dc.b	pitch,vol
                        	endm

                        ;!@	
                        ; Header - Set up PSG Channel
                        ;smpsHeaderPSG macro loc,pitch,vol,voice
                        smpsHeaderPSG macro loc,songstart,pitch,vol,null,voice
                        	;dc.w	loc-songStart
                        	rom_ptr_z80(loc+songstart)
                        	dc.b	pitch,vol
                        	;dc.w	voice
                        	dc.b	null,voice
                        	endm

                        ;!@
                        ; Header - Set up SFX Channel
                        ;sHeaderSFX	macro play,patch,loc,pitch,vol
                        smpsHeaderSFX	macro play,patch,loc,pitch,vol,songstart
                        	dc.b play,patch
                        	;dc.w loc-sPointZero
                        	rom_ptr_z80(loc+songstart)
                        	dc.b pitch,vol
                            endm

                        ; Co-ord Flag Macros and Equates
                        ; E0xx - Panning, AMS, FMS
                        smpsPan macro direction,amsfms
                        panNone set $00
                        panRight set $40
                        panLeft set $80
                        panCentre set $C0
                        panCenter set $C0 ; silly Americans :U
                        	;dc.b $E0,direction+amsfms
                        	;endm		
                        	if \0==2
                        		dc.b $E0,direction|amsfms
                        	else
                        		dc.b $E0,direction
                        	endif
000000                  	endm
                        	
                        ; E1xx - Alter note values by xx
                        smpsAlterNote macro val
                        	dc.b	$E1,val
                        	endm
                        	
                        ; E2xx - Unknown
                        smpsE2 macro val
                        	dc.b	$E2,val
                        	endm

                        ; E3 - Return (generally used after F8)
                        ; F9 - Return (generally used after F8)
                        smpsReturn macro val
                        	;!@
                        	;dc.b	$E3
                        	dc.b	$F9
                        	endm
                        	
                        ; E4 - Fade in previous song (ie. 1-Up)
                        smpsFade macro val
                        	dc.b	$E4
                        	endm

                        ;!@ Invalid for S3+!
                        ; E5xx - Set channel tempo divider to xx
                        smpsChanTempoDiv macro val
                        	;Error No S3 equivalent for CF!
                        	dc.b	$E5,val	
                        	endm
                        	
                        ; E6xx - Alter Volume by xx
                        smpsAlterVol macro val
                        	dc.b	$E6,val
                        	endm
                        	
                        ; E7 - Prevent attack of next note
       = 0000E7         smpsNoAttack	EQU $E7

                        ;!@ This may have problems, needs some convesion factor due to usage of mult by tempo div in S3+
                        ; E8xx - Set note fill to xx
                        smpsNoteFill macro val		
                        	dc.b	$E8,(val/TempDiv)
                        	endm
                        	
                        ;!@
                        ; E9xx - Add xx to channel pitch
                        ; FBxx - Add xx to channel pitch
                        smpsAlterPitch macro val
                        	;!@
                        	;dc.b	$E9,val
                        	dc.b	$FB,val
                        	endm
                        	
                        ;!@
                        ; EAxx - Set music tempo modifier to xx
                        ; FF00xx - Set music tempo to xx S3
                        smpsSetTempoMod macro val
                        	;dc.b	$EA,val
                        	dc.b	$FF,$00,val
                        	endm
                        	
                        ;!@
                        ; EAxx - Set music tempo modifier to xx
                        ; FF00xx - Set music tempo to xx S3 (TEMPO - TEMPO_SET)
                        smpsSetTempoModC macro val
                        	;dc.b	$EA,val
                        	dc.b $FF,$00
                        	tempo_conv(val)
                        	endm
                        	
                        ;!@
                        ; EBxx - Set music tempo divider to xx
                        ; FF04xx - Set global tick multiplier to xx (TICK_MULT - TMULT_ALL)
                        smpsSetTempoDiv macro val
                        	;dc.b	$EB,val
                        TempDiv set val
                        	dc.b $FF,$04,val
000000                  	endm

                        ;!@	
                        ; ECxx - Add xx to PSG channel volume (VOLUME - VOL_NN_PSG)
                        ;
                        ; May need interpolation/conversion factor:
                        ; Change volume attenuation of PSG track.
                        ;The single parameter byte is added to track's current volume attenuation;
                        ;anything greater than $0F (unsigned comparison) is set to $0F (silence). Also, the flutter index is reduced by 1.
                        smpsSetVol macro val
                        	dc.b	$EC,val
                        	endm
                        	
                        ; ED - Unknown
       = 0000ED         smpsED		EQU $ED
                        	
                        ;!@ S3K= send cmd to YM2612 port; unused in S1
                        ; EE - Stops special SFX ($D0-$D4, S1 only) and restarts overridden music track
       = 0000EE         smpsEE 		EQU $EE
                        	
                        ;!@
                        ; EFxx - Set Voice of FM channel to xx
                        ; EFxx[yy] - Set patch id of FM channel to xx. If xx bit7 set, read from another song instead
                        ; (INSTRUMENT - INS_C_FMP)
                        ;smpsFMvoice macro voice
                        	;dc.b	$EF,voice
                        smpsFMvoice macro pat, song		
                        	;if song<>""
                        	if \0==2
                        		dc.b $EF,pat|$80,song+$81
                        	else
                        		dc.b $EF,pat
                        	endif
                            endm

                        ; F0wwxxyyzz - Modulation - ww: wait time - xx: modulation speed - yy: change per step - zz: number of steps
                        smpsModSet macro wait,speed,change,step
                        	dc.b	$F0,wait,speed,change,step
                        	endm
                        	
                        smpsModSet2	macro bytes
                        	smpsModSet	((bytes&$FF000000)>>24),((bytes&$00FF0000)>>16),((bytes&$0000FF00)>>8),(bytes&$000000FF)
                        	endm
                        	
                        ; F0wwxxyyzz - Modulation - ww: wait time - xx: modulation speed - yy: change per step - zz: number of steps
                        ;!@
                        smpsModSetC macro wait,speed,change,step
                        	dc.b	$F0
                        	;if (SonicDriverVer>=3)&&(SourceDriver<3)
                        		dc.b	wait+1,speed,change,(step*speed+1)&$FF
                        	;elseif (SonicDriverVer<3)&&(SourceDriver>=3)
                        		;dc.b	wait-1,speed,change,(((step==0)<<8)|step)/(((step==0)<<8)|step)-1		
                        	;else
                        		;dc.b	wait,speed,change,step
                        	;endif
                        	;dc.b	speed,change,step
                        	endm

                        ;!@	
                        smpsModSetC2 macro bytes
                        	smpsModSetC	((bytes&$FF000000)>>24),((bytes&$00FF0000)>>16),((bytes&$0000FF00)>>8),(bytes&$000000FF)
                        	endm
                        	

                        ;!@ Used very differently in S3; don't use
                        ; F1 - Turn on Modulation
       = 0000F1         smpsModOn 	EQU $F1
                        ; F4 - Turn off Modulation
       = 0000F4         smpsModOff 	EQU $F4

                        ; F2 - End of channel
                        smpsStop macro
                        	dc.b	$F2
                        	endm
                        	
                        ;!@
                        ; F3xx - PSG waveform to xx
                        ; S3+ only: If parameter byte is zero, the channel is converted
                        ; back into a normal PSG channel and the noise channel is silenced.
                        ; Otherwise, sets the PSG track to noise and sets PSG noise to parameter byte, which should be from $E0 to $E7 (inclusive).
                        smpsPSGform macro form
                        	dc.b	$F3,form
                        	endm
                        	
                        ; F5xx - PSG voice to xx
                        smpsPSGvoice macro voice
                        	dc.b	$F5,voice
                        	endm
                        	
                        ;BAD Cmpr
                        ;if (loc<*)
                        	;rom_ptr_z80_neg(*-loc,songstart)
                        ;else
                        	;rom_ptr_z80(loc-*-1,songstart)
                        ;endif

                        ;!@
                        ; F6xxxx - Jump to xxxx
                        ;smpsJump macro loc
                        smpsJump macro loc,songstart
                        	dc.b	$F6
                        	if (loc<*)
                        		rom_ptr_z80(loc+songstart)
                        	else
                        		rom_ptr_z80(loc+songstart)
                        	endif
                        	;dc.w	loc-*-1
                        	endm

                        ;!@
                        ; F7xxyyzzzz - Loop back to zzzz yy times, xx being the loop index for loop recursion fixing
                        ;smpsLoop macro index,loops,loc
                        smpsLoop macro index,loops,loc,songstart
                        	dc.b	$F7
                        	dc.b	index,loops
                        	if (loc<*)
                        		rom_ptr_z80(loc+songstart)
                        	else
                        		rom_ptr_z80(loc+songstart)
                        	endif
                        	;dc.w	loc-*-1
                        	endm

                        ;!@
                        ; F8xxxx - Call pattern at xxxx, saving return point
                        ;smpsCall macro loc
                        smpsCall macro loc,songstart
                        	dc.b	$F8
                        	if (loc<*)
                        		rom_ptr_z80(loc+songstart)
                        	else
                        		rom_ptr_z80(loc+songstart)
                        	endif
                        	;dc.w	loc-*-1
                        	endm
                        	
                        ; F9 - Unknown
       = 0000F9         smpsF9		EQU $F9

                        ; Voices - Feedback
                        smpsVcFeedback macro val
                        vcFeedback set val
000000                  	endm

                        ; Voices - Algorithm
                        smpsVcAlgorithm macro val
                        vcAlgorithm set val
000000                  	endm

                        ; Voices - Detune
                        smpsVcDetune macro op1,op2,op3,op4
                        vcDT1 set op1
                        vcDT2 set op2
                        vcDT3 set op3
                        vcDT4 set op4
000000                  	endm

                        ; Voices - Coarse-Frequency
                        smpsVcCoarseFreq macro op1,op2,op3,op4
                        vcCF1 set op1
                        vcCF2 set op2
                        vcCF3 set op3
                        vcCF4 set op4
000000                  	endm

                        ; Voices - Rate Scale
                        smpsVcRateScale macro op1,op2,op3,op4
                        vcRS1 set op1
                        vcRS2 set op2
                        vcRS3 set op3
                        vcRS4 set op4
000000                  	endm

                        ; Voices - Attack Rate
                        smpsVcAttackRate macro op1,op2,op3,op4
                        vcAR1 set op1
                        vcAR2 set op2
                        vcAR3 set op3
                        vcAR4 set op4
000000                  	endm

                        ; Voices - Amplitude Modulation
                        smpsVcAmpMod macro op1,op2,op3,op4
                        vcAM1 set op1
                        vcAM2 set op2
                        vcAM3 set op3
                        vcAM4 set op4
000000                  	endm

                        ; Voices - First Decay Rate
                        smpsVcDecayRate1 macro op1,op2,op3,op4
                        vcD1R1 set op1
                        vcD1R2 set op2
                        vcD1R3 set op3
                        vcD1R4 set op4
000000                  	endm

                        ; Voices - Second Decay Rate
                        smpsVcDecayRate2 macro op1,op2,op3,op4
                        vcD2R1 set op1
                        vcD2R2 set op2
                        vcD2R3 set op3
                        vcD2R4 set op4
000000                  	endm

                        ; Voices - Decay Level	
                        smpsVcDecayLevel macro op1,op2,op3,op4
                        vcDL1 set op1
                        vcDL2 set op2
                        vcDL3 set op3
                        vcDL4 set op4
000000                  	endm

                        ; Voices - Release Rate
                        smpsVcReleaseRate macro op1,op2,op3,op4
                        vcRR1 set op1
                        vcRR2 set op2
                        vcRR3 set op3
                        vcRR4 set op4
000000                  	endm

                        ; Voices - Total Level
                        smpsVcTotalLevel macro op1,op2,op3,op4
                        vcTL1 set op1
                        vcTL2 set op2
                        vcTL3 set op3
                        vcTL4 set op4
                        	dc.b	(vcFeedback<<3)+vcAlgorithm
                        	dc.b	(vcDT4<<4)+vcCF4,(vcDT3<<4)+vcCF3,(vcDT2<<4)+vcCF2,(vcDT1<<4)+vcCF1
                        	dc.b	(vcRS4<<6)+vcAR4,(vcRS3<<6)+vcAR3,(vcRS2<<6)+vcAR2,(vcRS1<<6)+vcAR1
                        	dc.b	(vcAM4<<5)+vcD1R4,(vcAM3<<5)+vcD1R3,(vcAM2<<5)+vcD1R2,(vcAM1<<5)+vcD1R1
                        	dc.b	vcD2R4,vcD2R3,vcD2R2,vcD2R1
                        	dc.b	(vcDL4<<4)+vcRR4,(vcDL3<<4)+vcRR3,(vcDL2<<4)+vcRR2,(vcDL1<<4)+vcRR1
                        	dc.b	vcTL4,vcTL3,vcTL2,vcTL1	
000000                  	endm	
                        	
                        ;==============================================
                        ;!@ The following CF flags/macros are KC-drive specific!
                        ;Rest here mostly used  to compile KC/Nat ASM files for BC purposes...

                        ;!@
                        ; Header - Set up a secondary PWM Channel
                        ;smpsHeaderPWM macro loc
                        smpsHeaderPWM macro loc, songstart,pitch,volL,volR
                        	;dc.w	loc-songStart
                        	rom_ptr_z80(loc+songstart)	
                        	;!@
                        	dc.b	pitch
                        	if \0==4
                        		dc.b	volL
                        	else
                        		dc.b	(volL<<4)+volR
                        	endif	
                        	endm
                        	
                        ;!@ Unused and unneeded; leftover Sonic 32x header stuff
                        ; Header - Set up first PWM Channel
                        ;smpsHeaderPWM1 macro loc,num
                        	;dc.w	loc-songStart
                        	;dc.b	num,0
                        	;endm

                        ;!@
                        ; Header - Set up Tick Multiplier (for Sfx)
                        ;sHeaderSFX
                        smpsHeaderTick	macro tmul
                        	dc.b tmul
                            endm

                        ;!@ KC Exclusives!
                        ;# PAN_ANIM
                        ;# pan animation has 2 modes; if first arg is 0, it will end it. Otherwise, more args will be used
                        ;!0xE4, 0 > sPanAni:;								
                        ;!0xE4, 1-0xFF > sPanAni: .lb, .db, .db, .db, .db;	
                        KC_smpsPanAni macro val1,val2,val3,val4,val5
                        	if val1==0
                        		dc.b	$E4,$00
                        	else
                        		dc.b	$E4,val1,val2,val3,val4,val5
                        	endif
                        	endm


                        ; Alter Volume
                        ;!0xE5 > saVolFMP: .db, .db;								
                        KC_smpsFMAlterVol macro val1,val2
                        	dc.b	$E5,val1,val2
                        	endm

                        ;!@ KC Exclusive!	
                        ;!0xE9 > ssLFO: .db, .db;									
                        KC_smpsSetLFO macro enable,amsfms
                        	dc.b	$E9,enable,amsfms
                        	endm

                        ;!0xEA > sPlayDAC: .db | 0x80;								
                        KC_smpsPlayDACSample macro sample
                        	dc.b	$EA,(sample&$7F)
                        	endm

                        ;!@ Songstart param added
                        ;!0xEB > sLoopExit: .db, .dw {						
                        ;smpsConditionalJump macro index,loc
                        KC_smpsConditionalJump macro index,loc,songstart
                        	dc.b	$EB
                        	dc.b	index
                        	;dc.w	z80_ptr(loc)
                        	rom_ptr_z80(loc+songstart)
                        	endm

                        ;!@ Usage/naming is speculative. Called ssTransposeS3K in S3k/Nat driver...	
                        ;!0xED > sYMcmd: .db, .db;							
                        ; Set note values to xx-$40
                        KC_smpsSetNote macro val
                        	dc.b	$ED,val
                        	endm

                        ;!0xEE > sYM1cmd: .db, .db;							
                        KC_smpsFMICommand macro reg,val
                        	dc.b	$EE,reg,val
                        	endm

                        ;!0xF1 > sModEnv: .db, .db {							
                        ; Set Modulation
                        KC_smpsModChange2 macro fmmod,psgmod
                        	dc.b	$F1,fmmod,psgmod
                        	endm
                        	
                        ;!0xF4 > sModEnv: .db {
                        ; Set Modulation
                        KC_smpsModChange macro val
                        	dc.b	$F4,val
                        	endm

                        ;!@ KC exclusive!
                        ;!0xFC > sPitchSlide: .db;						
                        KC_smpsPitchSlide macro enable
                        	dc.b	$FC,enable
                        	endm
                        	
                        ;!0xFD > sRawFreq: .db;							
                        KC_smpsAlternateSMPS macro flag
                        	dc.b	$FD,flag
                        	endm

                        ;!0xFE > sSpecFM3: .db, .db, .db, .db {			
                        	;%; Broken?
                        ;}
                        KC_smpsFM3SpecialMode macro ind1,ind2,ind3,ind4
                        	dc.b	$FE,ind1,ind2,ind3,ind4
                        	Error Broken?
                        	endm

                        ;!0xFF, 1 > sPlaySound: .db;						
                        KC_smpsPlaySound macro index
                        	dc.b	$FF,$01,index
                        	endm

                        ;!0xFF, 2 > sMusPause: .db;						
                        KC_smpsHaltMusic macro flag
                        	dc.b	$FF,$02,flag
                        	endm

                        ;!@ Modified with SongStart	param
                        ;!0xFF, 3 > sCopyMem: .dw, .db {					
                        	;%; No song should ever use this command. It may good idea to remove it.
                        ;}
                        ;KC_smpsCopyData macro data,len
                        KC_smpsCopyData macro data,len,songstart
                        	Error Coord. Flag to copy data should not be used. Complain to GenesisDoes if any music uses it.
                        	;Error No song should ever use this command. It may be a good idea to remove it.
                        	dc.b	$FF,$03
                        	;dc.w	little_endian(data)
                        	rom_ptr_z80(data+songstart)
                        	dc.b	len
                        	endm

                        ;!0xFF, 5 > sSSGEG: .db, .db, .db, .db {			
                        	;=op2 .a2
                        	;:=2 .a1
                        	;:=1 \op2\
                        ;}
                        KC_smpsSSGEG macro op1,op2,op3,op4
                        	dc.b	$FF,$05,op1,op3,op2,op4
                        	endm
                        	
                        	
                        ;!0xFF, 6 > sVolEnvFM: .db, .db {
                        	;:?0 {
                        		;?volenv;
                        	;}
                        ;}	
                        KC_smpsFMVolEnv macro tone,mask
                        	dc.b	$FF,$06,tone,mask
                        	endm
                        ;==============================================

000000                  	include "KC.asm"
       = 040000         Target	EQU	$40000

       = 000000         FMPitch		EQU	$00
                        ;!@
                        ;FMVol1		EQU	$0F
                        ;FMVol2		EQU	$1F
       = 000007         FMVol1		EQU	$07
       = 00000F         FMVol2		EQU	$0F

       = 00000C         PSGPitch 	EQU	PSGDelta
                        ;!@
                        ;PSGVol		EQU	$07
       = 000003         PSGVol1		EQU	$03
       = 000005         PSGVol2		EQU	$05
       = 000000         PSGMod		EQU	$00
       = 000000         PSGVoi1		EQU	$00
       = 000001         PSGVoi2		EQU	$01

       = 000000         PWMPitch	EQU	$00
       = 0000AA         PWMVol1		EQU	$AA
       = 000055         PWMVol2		EQU	$55

000000                  	smpsHeaderVoice	KSSU_HelperReset_Patches, Target
                        ;songStart set *
                        	;dc.w	loc-songStart
000000                  	rom_ptr_z80(KSSU_HelperReset_Patches+Target)
                        	;dc.w z80_ptr(ptr,addr)
000000 5B82             	dc.w  (((((KSSU_HelperReset_Patches+Target))<<8)&$FF00)|((((KSSU_HelperReset_Patches+Target))>>8)&$7F)|$80)
000002                  	smpsHeaderChan	$06, $03
                        	if 2==2
000002 0603             		dc.b	$06,$03
                        	else
                        	endif	
000004                  	smpsHeaderTempo	$04, $20
000004 0420             	dc.b	$04,$20
000006                  	smpsHeaderFM	KSSU_HelperReset_FM1, Target, FMPitch, FMVol1
                        	;dc.w	loc-songStart
000006                  	rom_ptr_z80(KSSU_HelperReset_FM1+Target)
                        	;dc.w z80_ptr(ptr,addr)
000006 4080             	dc.w  (((((KSSU_HelperReset_FM1+Target))<<8)&$FF00)|((((KSSU_HelperReset_FM1+Target))>>8)&$7F)|$80)
000008 0007             	dc.b	FMPitch,FMVol1
00000A                  	smpsHeaderFM	KSSU_HelperReset_FM2, Target, FMPitch, FMVol2
                        	;dc.w	loc-songStart
00000A                  	rom_ptr_z80(KSSU_HelperReset_FM2+Target)
                        	;dc.w z80_ptr(ptr,addr)
00000A 8980             	dc.w  (((((KSSU_HelperReset_FM2+Target))<<8)&$FF00)|((((KSSU_HelperReset_FM2+Target))>>8)&$7F)|$80)
00000C 000F             	dc.b	FMPitch,FMVol2
00000E                  	smpsHeaderFM	KSSU_HelperReset_FM3, Target, FMPitch, FMVol1
                        	;dc.w	loc-songStart
00000E                  	rom_ptr_z80(KSSU_HelperReset_FM3+Target)
                        	;dc.w z80_ptr(ptr,addr)
00000E D280             	dc.w  (((((KSSU_HelperReset_FM3+Target))<<8)&$FF00)|((((KSSU_HelperReset_FM3+Target))>>8)&$7F)|$80)
000010 0007             	dc.b	FMPitch,FMVol1
000012                  	smpsHeaderFM	KSSU_HelperReset_FM4, Target, FMPitch, FMVol2
                        	;dc.w	loc-songStart
000012                  	rom_ptr_z80(KSSU_HelperReset_FM4+Target)
                        	;dc.w z80_ptr(ptr,addr)
000012 0B81             	dc.w  (((((KSSU_HelperReset_FM4+Target))<<8)&$FF00)|((((KSSU_HelperReset_FM4+Target))>>8)&$7F)|$80)
000014 000F             	dc.b	FMPitch,FMVol2
000016                  	smpsHeaderFM	KSSU_HelperReset_FM5, Target, FMPitch, FMVol1
                        	;dc.w	loc-songStart
000016                  	rom_ptr_z80(KSSU_HelperReset_FM5+Target)
                        	;dc.w z80_ptr(ptr,addr)
000016 4481             	dc.w  (((((KSSU_HelperReset_FM5+Target))<<8)&$FF00)|((((KSSU_HelperReset_FM5+Target))>>8)&$7F)|$80)
000018 0007             	dc.b	FMPitch,FMVol1
00001A                  	smpsHeaderFM	KSSU_HelperReset_FM6, Target, FMPitch, FMVol2
                        	;dc.w	loc-songStart
00001A                  	rom_ptr_z80(KSSU_HelperReset_FM6+Target)
                        	;dc.w z80_ptr(ptr,addr)
00001A 5881             	dc.w  (((((KSSU_HelperReset_FM6+Target))<<8)&$FF00)|((((KSSU_HelperReset_FM6+Target))>>8)&$7F)|$80)
00001C 000F             	dc.b	FMPitch,FMVol2
00001E                  	smpsHeaderPSG	KSSU_HelperReset_PSG1, Target, PSGPitch, PSGVol1, PSGMod, PSGVoi1
                        	;dc.w	loc-songStart
00001E                  	rom_ptr_z80(KSSU_HelperReset_PSG1+Target)
                        	;dc.w z80_ptr(ptr,addr)
00001E 6C81             	dc.w  (((((KSSU_HelperReset_PSG1+Target))<<8)&$FF00)|((((KSSU_HelperReset_PSG1+Target))>>8)&$7F)|$80)
000020 0C03             	dc.b	PSGPitch,PSGVol1
                        	;dc.w	voice
000022 0000             	dc.b	PSGMod,PSGVoi1
000024                  	smpsHeaderPSG	KSSU_HelperReset_PSG2, Target, PSGPitch, PSGVol1, PSGMod, PSGVoi1
                        	;dc.w	loc-songStart
000024                  	rom_ptr_z80(KSSU_HelperReset_PSG2+Target)
                        	;dc.w z80_ptr(ptr,addr)
000024 B181             	dc.w  (((((KSSU_HelperReset_PSG2+Target))<<8)&$FF00)|((((KSSU_HelperReset_PSG2+Target))>>8)&$7F)|$80)
000026 0C03             	dc.b	PSGPitch,PSGVol1
                        	;dc.w	voice
000028 0000             	dc.b	PSGMod,PSGVoi1
                        	;!@ smpsHeaderPSG	KSSU_HelperReset_PSG3, Target, PSGPitch, PSGVol1, PSGMod, PSGVoi2
00002A                  	smpsHeaderPSG	KSSU_HelperReset_PSG3, Target, PSGPitch, PSGVol2, PSGMod, PSGVoi1
                        	;dc.w	loc-songStart
00002A                  	rom_ptr_z80(KSSU_HelperReset_PSG3+Target)
                        	;dc.w z80_ptr(ptr,addr)
00002A E881             	dc.w  (((((KSSU_HelperReset_PSG3+Target))<<8)&$FF00)|((((KSSU_HelperReset_PSG3+Target))>>8)&$7F)|$80)
00002C 0C05             	dc.b	PSGPitch,PSGVol2
                        	;dc.w	voice
00002E 0000             	dc.b	PSGMod,PSGVoi1
000030                  	smpsHeaderPWM	KSSU_HelperReset_PWM1, Target, PWMPitch, PWMVol1
                        	;dc.w	loc-songStart
000030                  	rom_ptr_z80(KSSU_HelperReset_PWM1+Target)	
                        	;dc.w z80_ptr(ptr,addr)
000030 FA81             	dc.w  (((((KSSU_HelperReset_PWM1+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM1+Target))>>8)&$7F)|$80)
                        	;!@
000032 00               	dc.b	PWMPitch
                        	if 4==4
000033 AA               		dc.b	PWMVol1
                        	else
                        	endif	
000034                  	smpsHeaderPWM	KSSU_HelperReset_PWM2, Target, PWMPitch, PWMVol1
                        	;dc.w	loc-songStart
000034                  	rom_ptr_z80(KSSU_HelperReset_PWM2+Target)	
                        	;dc.w z80_ptr(ptr,addr)
000034 1782             	dc.w  (((((KSSU_HelperReset_PWM2+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM2+Target))>>8)&$7F)|$80)
                        	;!@
000036 00               	dc.b	PWMPitch
                        	if 4==4
000037 AA               		dc.b	PWMVol1
                        	else
                        	endif	
000038                  	smpsHeaderPWM	KSSU_HelperReset_PWM3, Target, PWMPitch, PWMVol1
                        	;dc.w	loc-songStart
000038                  	rom_ptr_z80(KSSU_HelperReset_PWM3+Target)	
                        	;dc.w z80_ptr(ptr,addr)
000038 3282             	dc.w  (((((KSSU_HelperReset_PWM3+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM3+Target))>>8)&$7F)|$80)
                        	;!@
00003A 00               	dc.b	PWMPitch
                        	if 4==4
00003B AA               		dc.b	PWMVol1
                        	else
                        	endif	
00003C                  	smpsHeaderPWM	KSSU_HelperReset_PWM4, Target, PWMPitch, PWMVol1
                        	;dc.w	loc-songStart
00003C                  	rom_ptr_z80(KSSU_HelperReset_PWM4+Target)	
                        	;dc.w z80_ptr(ptr,addr)
00003C 4B82             	dc.w  (((((KSSU_HelperReset_PWM4+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM4+Target))>>8)&$7F)|$80)
                        	;!@
00003E 00               	dc.b	PWMPitch
                        	if 4==4
00003F AA               		dc.b	PWMVol1
                        	else
                        	endif	

000040                  KSSU_HelperReset_FM1:
000040                  	smpsFMvoice		$00
                        	;if song<>""
                        	if 1==2
                        	else
000040 EF00             		dc.b $EF,$00
                        	endif

000042                  KSSU_HelperReset_Jump1:
000042                  	smpsPan		panRight
       = 000000         panNone set $00
       = 000040         panRight set $40
       = 000080         panLeft set $80
       = 0000C0         panCentre set $C0
       = 0000C0         panCenter set $C0 ; silly Americans :U
                        	;dc.b $E0,direction+amsfms
                        	;endm		
                        	if 1==2
                        	else
000042 E040             		dc.b $E0,panRight
                        	endif
000044 B604BABDC1C2C1BD 	dc.b nF4, $04, nA4, nC5, nE5, nF5, nE5, nC5
00004C BAB5B8BCBFC1BFBC 	dc.b nA4, nE4, nG4, nB4, nD5, nE5, nD5, nB4
000054 B8B3B6BABDBFBDBA 	dc.b nG4, nD4, nF4, nA4, nC5, nD5, nC5, nA4
00005C B6B5B7BABEC1BEBA 	dc.b nF4, nE4, nFs4, nA4, nCs5, nE5, nCs5, nA4
000064 B7B6BABDC1C2C1BD 	dc.b nFs4, nF4, nA4, nC5, nE5, nF5, nE5, nC5
00006C BAB5B8BCBFC1BFBC 	dc.b nA4, nE4, nG4, nB4, nD5, nE5, nD5, nB4
000074 B8B6BABDBFB3B6BA 	dc.b nG4, nF4, nA4, nC5, nD5, nD4, nF4, nA4
00007C BDAEB1B5B8ACB1B5 	dc.b nC5, nA3, nC4, nE4, nG4, nG3, nC4, nE4
000084 B880             	dc.b nG4, nRst
000086                  	smpsJump		KSSU_HelperReset_Jump1, Target
000086 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_Jump1<*)
000087                  		rom_ptr_z80(KSSU_HelperReset_Jump1+Target)
                        	;dc.w z80_ptr(ptr,addr)
000087 4280             	dc.w  (((((KSSU_HelperReset_Jump1+Target))<<8)&$FF00)|((((KSSU_HelperReset_Jump1+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1

000089                  KSSU_HelperReset_FM2:
000089                  	smpsFMvoice		$00
                        	;if song<>""
                        	if 1==2
                        	else
000089 EF00             		dc.b $EF,$00
                        	endif

00008B                  KSSU_HelperReset_Jump2:
00008B                  	smpsPan		panLeft
       = 000000         panNone set $00
       = 000040         panRight set $40
       = 000080         panLeft set $80
       = 0000C0         panCentre set $C0
       = 0000C0         panCenter set $C0 ; silly Americans :U
                        	;dc.b $E0,direction+amsfms
                        	;endm		
                        	if 1==2
                        	else
00008B E080             		dc.b $E0,panLeft
                        	endif
00008D 8004B6BABDC1C2C1 	dc.b nRst, $04, nF4, nA4, nC5, nE5, nF5, nE5
000095 BDBAB5B8BCBFC1BF 	dc.b nC5, nA4, nE4, nG4, nB4, nD5, nE5, nD5
00009D BCB8B3B6BABDBFBD 	dc.b nB4, nG4, nD4, nF4, nA4, nC5, nD5, nC5
0000A5 BAB6B5B7BABEC1BE 	dc.b nA4, nF4, nE4, nFs4, nA4, nCs5, nE5, nCs5
0000AD BAB7B6BABDC1C2C1 	dc.b nA4, nFs4, nF4, nA4, nC5, nE5, nF5, nE5
0000B5 BDBAB5B8BCBFC1BF 	dc.b nC5, nA4, nE4, nG4, nB4, nD5, nE5, nD5
0000BD BCB8B6BABDBFB3B6 	dc.b nB4, nG4, nF4, nA4, nC5, nD5, nD4, nF4
0000C5 BABDAEB1B5B8ACB1 	dc.b nA4, nC5, nA3, nC4, nE4, nG4, nG3, nC4
0000CD B5B8             	dc.b nE4, nG4
0000CF                  	smpsJump		KSSU_HelperReset_Jump2, Target
0000CF F6               	dc.b	$F6
                        	if (KSSU_HelperReset_Jump2<*)
0000D0                  		rom_ptr_z80(KSSU_HelperReset_Jump2+Target)
                        	;dc.w z80_ptr(ptr,addr)
0000D0 8B80             	dc.w  (((((KSSU_HelperReset_Jump2+Target))<<8)&$FF00)|((((KSSU_HelperReset_Jump2+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1

0000D2                  KSSU_HelperReset_FM3:
0000D2                  	smpsFMvoice		$01
                        	;if song<>""
                        	if 1==2
                        	else
0000D2 EF01             		dc.b $EF,$01
                        	endif

0000D4                  KSSU_HelperReset_Jump3:
0000D4                  	smpsPan		panRight
       = 000000         panNone set $00
       = 000040         panRight set $40
       = 000080         panLeft set $80
       = 0000C0         panCentre set $C0
       = 0000C0         panCenter set $C0 ; silly Americans :U
                        	;dc.b $E0,direction+amsfms
                        	;endm		
                        	if 1==2
                        	else
0000D4 E040             		dc.b $E0,panRight
                        	endif
0000D6 BA0CBC04BD08C6C4 	dc.b nA4, $0C, nB4, $04, nC5, $08, nA5, nG5
0000DE C104BFC108BABFC2 	dc.b nE5, $04, nD5, nE5, $08, nA4, nD5, nF5
0000E6 C4C2C1C6C5C1BD04 	dc.b nG5, nF5, nE5, nA5, nAb5, nE5, nC5, $04
0000EE BCBABCBD08C6C4C1 	dc.b nB4, nA4, nB4, nC5, $08, nA5, nG5, nE5
0000F6 04BFC108BABFC2C4 	dc.b $04, nD5, nE5, $08, nA4, nD5, nF5, nG5
0000FE C2C1BD04BCBD08BC 	dc.b nF5, nE5, nC5, $04, nB4, nC5, $08, nB4
000106 8004             	dc.b nRst, $04
000108                  	smpsJump		KSSU_HelperReset_Jump3, Target
000108 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_Jump3<*)
000109                  		rom_ptr_z80(KSSU_HelperReset_Jump3+Target)
                        	;dc.w z80_ptr(ptr,addr)
000109 D480             	dc.w  (((((KSSU_HelperReset_Jump3+Target))<<8)&$FF00)|((((KSSU_HelperReset_Jump3+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1

00010B                  KSSU_HelperReset_FM4:
00010B                  	smpsFMvoice		$01
                        	;if song<>""
                        	if 1==2
                        	else
00010B EF01             		dc.b $EF,$01
                        	endif

00010D                  KSSU_HelperReset_Jump4:
00010D                  	smpsPan		panLeft
       = 000000         panNone set $00
       = 000040         panRight set $40
       = 000080         panLeft set $80
       = 0000C0         panCentre set $C0
       = 0000C0         panCenter set $C0 ; silly Americans :U
                        	;dc.b $E0,direction+amsfms
                        	;endm		
                        	if 1==2
                        	else
00010D E080             		dc.b $E0,panLeft
                        	endif
00010F 8004BA0CBC04BD08 	dc.b nRst, $04, nA4, $0C, nB4, $04, nC5, $08
000117 C6C4C104BFC108BA 	dc.b nA5, nG5, nE5, $04, nD5, nE5, $08, nA4
00011F BFC2C4C2C1C6C5C1 	dc.b nD5, nF5, nG5, nF5, nE5, nA5, nAb5, nE5
000127 BD04BCBABCBD08C6 	dc.b nC5, $04, nB4, nA4, nB4, nC5, $08, nA5
00012F C4C104BFC108BABF 	dc.b nG5, nE5, $04, nD5, nE5, $08, nA4, nD5
000137 C2C4C2C1BD04BCBD 	dc.b nF5, nG5, nF5, nE5, nC5, $04, nB4, nC5
00013F 08BC             	dc.b $08, nB4
000141                  	smpsJump		KSSU_HelperReset_Jump4, Target
000141 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_Jump4<*)
000142                  		rom_ptr_z80(KSSU_HelperReset_Jump4+Target)
                        	;dc.w z80_ptr(ptr,addr)
000142 0D81             	dc.w  (((((KSSU_HelperReset_Jump4+Target))<<8)&$FF00)|((((KSSU_HelperReset_Jump4+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1

000144                  KSSU_HelperReset_FM5:
000144                  	smpsFMvoice		$02
                        	;if song<>""
                        	if 1==2
                        	else
000144 EF02             		dc.b $EF,$02
                        	endif
000146                  	smpsPan		panRight
       = 000000         panNone set $00
       = 000040         panRight set $40
       = 000080         panLeft set $80
       = 0000C0         panCentre set $C0
       = 0000C0         panCenter set $C0 ; silly Americans :U
                        	;dc.b $E0,direction+amsfms
                        	;endm		
                        	if 1==2
                        	else
000146 E040             		dc.b $E0,panRight
                        	endif
000148 AA20A9A7ABAAA9A7 	dc.b nF3, $20, nE3, nD3, nFs3, nF3, nE3, nD3
000150 A210A08004       	dc.b nA2, $10, nG2, nRst, $04
000155                  	smpsJump		KSSU_HelperReset_FM5, Target
000155 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_FM5<*)
000156                  		rom_ptr_z80(KSSU_HelperReset_FM5+Target)
                        	;dc.w z80_ptr(ptr,addr)
000156 4481             	dc.w  (((((KSSU_HelperReset_FM5+Target))<<8)&$FF00)|((((KSSU_HelperReset_FM5+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1

000158                  KSSU_HelperReset_FM6:
000158                  	smpsFMvoice		$02
                        	;if song<>""
                        	if 1==2
                        	else
000158 EF02             		dc.b $EF,$02
                        	endif
00015A                  	smpsPan		panLeft
       = 000000         panNone set $00
       = 000040         panRight set $40
       = 000080         panLeft set $80
       = 0000C0         panCentre set $C0
       = 0000C0         panCenter set $C0 ; silly Americans :U
                        	;dc.b $E0,direction+amsfms
                        	;endm		
                        	if 1==2
                        	else
00015A E080             		dc.b $E0,panLeft
                        	endif
00015C 8004AA20A9A7ABAA 	dc.b nRst, $04, nF3, $20, nE3, nD3, nFs3, nF3
000164 A9A7A210A0       	dc.b nE3, nD3, nA2, $10, nG2
000169                  	smpsJump		KSSU_HelperReset_FM6, Target
000169 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_FM6<*)
00016A                  		rom_ptr_z80(KSSU_HelperReset_FM6+Target)
                        	;dc.w z80_ptr(ptr,addr)
00016A 5881             	dc.w  (((((KSSU_HelperReset_FM6+Target))<<8)&$FF00)|((((KSSU_HelperReset_FM6+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1

00016C                  KSSU_HelperReset_PSG1:
00016C 920496999D9E9D99 	dc.b nF1, $04, nA1, nC2, nE2, nF2, nE2, nC2
000174 969194989B9D9B98 	dc.b nA1, nE1, nG1, nB1, nD2, nE2, nD2, nB1
00017C 948F9296999B9996 	dc.b nG1, nD1, nF1, nA1, nC2, nD2, nC2, nA1
000184 929193969A9D9A96 	dc.b nF1, nE1, nFs1, nA1, nCs2, nE2, nCs2, nA1
00018C 939296999D9E9D99 	dc.b nFs1, nF1, nA1, nC2, nE2, nF2, nE2, nC2
000194 969194989B9D9B98 	dc.b nA1, nE1, nG1, nB1, nD2, nE2, nD2, nB1
00019C 949296999B8F9296 	dc.b nG1, nF1, nA1, nC2, nD2, nD1, nF1, nA1
0001A4 998A8D9194888D91 	dc.b nC2, nA0, nC1, nE1, nG1, nG0, nC1, nE1
0001AC 9480             	dc.b nG1, nRst
                        	;!@ smpsStop
0001AE                  	smpsJump		KSSU_HelperReset_PSG1, Target
0001AE F6               	dc.b	$F6
                        	if (KSSU_HelperReset_PSG1<*)
0001AF                  		rom_ptr_z80(KSSU_HelperReset_PSG1+Target)
                        	;dc.w z80_ptr(ptr,addr)
0001AF 6C81             	dc.w  (((((KSSU_HelperReset_PSG1+Target))<<8)&$FF00)|((((KSSU_HelperReset_PSG1+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1

0001B1                  KSSU_HelperReset_PSG2:
0001B1                  	smpsPSGvoice	PSGVoi1
0001B1 F500             	dc.b	$F5,PSGVoi1
0001B3 960C98049908A2A0 	dc.b nA1, $0C, nB1, $04, nC2, $08, nA2, nG2
0001BB 9D049B9D08969B9E 	dc.b nE2, $04, nD2, nE2, $08, nA1, nD2, nF2
0001C3 A09E9DA2A19D9904 	dc.b nG2, nF2, nE2, nA2, nAb2, nE2, nC2, $04
0001CB 9896989908A2A09D 	dc.b nB1, nA1, nB1, nC2, $08, nA2, nG2, nE2
0001D3 049B9D08969B9EA0 	dc.b $04, nD2, nE2, $08, nA1, nD2, nF2, nG2
0001DB 9E9D990498990898 	dc.b nF2, nE2, nC2, $04, nB1, nC2, $08, nB1
0001E3 8004             	dc.b nRst, $04
0001E5                  	smpsJump		KSSU_HelperReset_PSG2, Target
0001E5 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_PSG2<*)
0001E6                  		rom_ptr_z80(KSSU_HelperReset_PSG2+Target)
                        	;dc.w z80_ptr(ptr,addr)
0001E6 B181             	dc.w  (((((KSSU_HelperReset_PSG2+Target))<<8)&$FF00)|((((KSSU_HelperReset_PSG2+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1

0001E8                  KSSU_HelperReset_PSG3:
                        	;!@
                        	; smpsPSGvoice	PSGVoi2
0001E8                  	smpsPSGvoice	PSGVoi1
0001E8 F500             	dc.b	$F5,PSGVoi1
0001EA 8620858387868583 	dc.b nF0, $20, nE0, nD0, nFs0, nF0, nE0, nD0
0001F2 8110108004       	dc.b nC0, $10, $10, nRst, $04
0001F7                  	smpsJump		KSSU_HelperReset_PSG3, Target
0001F7 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_PSG3<*)
0001F8                  		rom_ptr_z80(KSSU_HelperReset_PSG3+Target)
                        	;dc.w z80_ptr(ptr,addr)
0001F8 E881             	dc.w  (((((KSSU_HelperReset_PSG3+Target))<<8)&$FF00)|((((KSSU_HelperReset_PSG3+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1
                        	
0001FA                  KSSU_HelperReset_PWM1:
0001FA 8920             	dc.b pCrashCymb, $20

0001FC                  KSSU_HelperReset_PWM1_Loop1:
0001FC 8104980202020281 	dc.b pEKick, $04, pClosedHH, $02, $02, $02, $02, pEKick
000204 0404980202820498 	dc.b $04, $04, pClosedHH, $02, $02, pESnare, $04, pClosedHH
00020C 0202             	dc.b $02, $02
00020E                  	smpsLoop		$00, $07, KSSU_HelperReset_PWM1_Loop1, Target
00020E F7               	dc.b	$F7
00020F 0007             	dc.b	$00,$07
                        	if (KSSU_HelperReset_PWM1_Loop1<*)
000211                  		rom_ptr_z80(KSSU_HelperReset_PWM1_Loop1+Target)
                        	;dc.w z80_ptr(ptr,addr)
000211 FC81             	dc.w  (((((KSSU_HelperReset_PWM1_Loop1+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM1_Loop1+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1
000213 04               	dc.b $04
000214                  	smpsJump		KSSU_HelperReset_PWM1, Target
000214 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_PWM1<*)
000215                  		rom_ptr_z80(KSSU_HelperReset_PWM1+Target)
                        	;dc.w z80_ptr(ptr,addr)
000215 FA81             	dc.w  (((((KSSU_HelperReset_PWM1+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM1+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1
                        	
000217                  KSSU_HelperReset_PWM2:
000217 892098           	dc.b pCrashCymb, $20, pClosedHH

00021A                  KSSU_HelperReset_PWM2_Loop1:
00021A 020A020202060206 	dc.b $02, $0A, $02, $02, $02, $06, $02, $06
000222                  	smpsLoop		$00, $06, KSSU_HelperReset_PWM2_Loop1, Target
000222 F7               	dc.b	$F7
000223 0006             	dc.b	$00,$06
                        	if (KSSU_HelperReset_PWM2_Loop1<*)
000225                  		rom_ptr_z80(KSSU_HelperReset_PWM2_Loop1+Target)
                        	;dc.w z80_ptr(ptr,addr)
000225 1A82             	dc.w  (((((KSSU_HelperReset_PWM2_Loop1+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM2_Loop1+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1
000227 020A02020206020A 	dc.b $02, $0A, $02, $02, $02, $06, $02, $0A
00022F                  	smpsJump		KSSU_HelperReset_PWM2, Target
00022F F6               	dc.b	$F6
                        	if (KSSU_HelperReset_PWM2<*)
000230                  		rom_ptr_z80(KSSU_HelperReset_PWM2+Target)
                        	;dc.w z80_ptr(ptr,addr)
000230 1782             	dc.w  (((((KSSU_HelperReset_PWM2+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM2+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1
                        	
000232                  KSSU_HelperReset_PWM3:
000232 8104980202020281 	dc.b pEKick, $04, pClosedHH, $02, $02, $02, $02, pEKick
00023A 0404980202820498 	dc.b $04, $04, pClosedHH, $02, $02, pESnare, $04, pClosedHH
000242 023F80808029     	dc.b $02, $3F, nRst, nRst, nRst, $29
000248                  	smpsJump		KSSU_HelperReset_PWM3, Target
000248 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_PWM3<*)
000249                  		rom_ptr_z80(KSSU_HelperReset_PWM3+Target)
                        	;dc.w z80_ptr(ptr,addr)
000249 3282             	dc.w  (((((KSSU_HelperReset_PWM3+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM3+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1
                        	
00024B                  KSSU_HelperReset_PWM4:
00024B 98020A0202020602 	dc.b pClosedHH, $02, $0A, $02, $02, $02, $06, $02
000253 3F8080802D       	dc.b $3F, nRst, nRst, nRst, $2D
000258                  	smpsJump		KSSU_HelperReset_PWM4, Target
000258 F6               	dc.b	$F6
                        	if (KSSU_HelperReset_PWM4<*)
000259                  		rom_ptr_z80(KSSU_HelperReset_PWM4+Target)
                        	;dc.w z80_ptr(ptr,addr)
000259 4B82             	dc.w  (((((KSSU_HelperReset_PWM4+Target))<<8)&$FF00)|((((KSSU_HelperReset_PWM4+Target))>>8)&$7F)|$80)
                        	else
                        	endif
                        	;dc.w	loc-*-1

00025B                  KSSU_HelperReset_Patches:

                        	; Patch $00
                        	; Orch strings
                        	; $3A
                        	; $71, $0C, $33, $01,	$1C, $16, $1D, $1F
                        	; $04, $06, $04, $08,	$00, $01, $03, $00
                        	; $16, $17, $16, $A6,	$25, $2F, $25, $80	
00025B 3A               	dc.b	$3A
00025C 710C33011C161D1F 	dc.b	$71, $0C, $33, $01,	$1C, $16, $1D, $1F
000264 0406040800010300 	dc.b	$04, $06, $04, $08,	$00, $01, $03, $00
                        	;!@ dc.b	$16, $17, $16, $A6,	$25, $2F, $25, $80
00026C 161716A6252F3008 	dc.b	$16, $17, $16, $A6,	$25, $2F, $30, $08
                        	
                        	; smpsVcAlgorithm	$02
                        	; smpsVcFeedback	$07
                        	; smpsVcDetune	$07, $03, $00, $00
                        	; smpsVcCoarseFreq	$01, $03, $0C, $01
                        	; smpsVcRateScale	$00, $00, $00, $00
                        	; smpsVcAttackRate	$1C, $1D, $16, $1F
                        	; smpsVcAmpMod	$00, $00, $00, $00
                        	; smpsVcDecayRate1	$04, $04, $06, $08
                        	; smpsVcDecayRate2	$01, $01, $01, $0A
                        	; smpsVcDecayLevel	$00, $03, $01, $00
                        	; smpsVcReleaseRate	$06, $06, $07, $06
                        	; smpsVcTotalLevel	$25, $25, $2F, $00

                        	; Patch $01
                        	; Violin
                        	; $3A
                        	; $01, $05, $31, $01,	$59, $59, $5C, $4E
                        	; $0A, $0B, $0D, $04,	$03, $02, $03, $06
                        	; $15, $58, $27, $06,	$1D, $0F, $30, $80
000274 3A               	dc.b	$3A
000275 0105310159595C4E 	dc.b	$01, $05, $31, $01,	$59, $59, $5C, $4E
00027D 0A0B0D0403020306 	dc.b	$0A, $0B, $0D, $04,	$03, $02, $03, $06
                        	;!@ dc.b	$15, $58, $27, $06,	$1D, $0F, $30, $80
000285 1558270620133080 	dc.b	$15, $58, $27, $06,	$20, $13, $30, $80
                        	; smpsVcAlgorithm	$02
                        	; smpsVcFeedback	$07
                        	; smpsVcDetune	$00, $03, $00, $00
                        	; smpsVcCoarseFreq	$01, $01, $05, $01
                        	; smpsVcRateScale	$01, $01, $01, $01
                        	; smpsVcAttackRate	$19, $1C, $19, $0E
                        	; smpsVcAmpMod	$00, $00, $00, $00
                        	; smpsVcDecayRate1	$0A, $0D, $0B, $04
                        	; smpsVcDecayRate2	$01, $02, $05, $00
                        	; smpsVcDecayLevel	$03, $03, $02, $06
                        	; smpsVcReleaseRate	$05, $07, $08, $06
                        	; smpsVcTotalLevel	$1D, $30, $0F, $00

                        	; Patch $02
                        	; Piccolo
                        	; $34
                        	; $73, $02, $01, $31,	$52, $5F, $5F, $1F
                        	; $05, $05, $05, $0A,	$03, $04, $04, $04
                        	; $21, $11, $23, $45,	$1E, $90, $23, $86
00028D 34               	dc.b	$34
00028E 73020131525F5F1F 	dc.b	$73, $02, $01, $31,	$52, $5F, $5F, $1F
000296 0505050A03040404 	dc.b	$05, $05, $05, $0A,	$03, $04, $04, $04
00029E 211123451E902386 	dc.b	$21, $11, $23, $45,	$1E, $90, $23, $86
                        	; smpsVcAlgorithm	$04
                        	; smpsVcFeedback	$06
                        	; smpsVcDetune	$07, $00, $00, $03
                        	; smpsVcCoarseFreq	$03, $01, $02, $01
                        	; smpsVcRateScale	$01, $01, $01, $00
                        	; smpsVcAttackRate	$12, $1F, $1F, $1F
                        	; smpsVcAmpMod	$00, $00, $00, $00
                        	; smpsVcDecayRate1	$05, $05, $05, $0A
                        	; smpsVcDecayRate2	$02, $02, $01, $04
                        	; smpsVcDecayLevel	$03, $04, $04, $04
                        	; smpsVcReleaseRate	$01, $03, $01, $05
                        	; smpsVcTotalLevel	$1E, $23, $10, $06

00000 Total Error(s)

DFLOORTIMPANI      0000008B E  DHITIMPANI         00000088 E  DKICK              00000081 E
DLOWTIMPANI        0000008A E  DMIDTIMPANI        00000089 E  DSNARE             00000082 E
DTIMPANI           00000083 E  DVLOWTIMPANI       0000008B E  FMPITCH            00000000 E
FMVOL1             00000007 E  FMVOL2             0000000F E  
KSSU_HELPERRESET_FM1                          00000040    
KSSU_HELPERRESET_FM2                          00000089    
KSSU_HELPERRESET_FM3                          000000D2    
KSSU_HELPERRESET_FM4                          0000010B    
KSSU_HELPERRESET_FM5                          00000144    
KSSU_HELPERRESET_FM6                          00000158    
KSSU_HELPERRESET_JUMP1                        00000042    
KSSU_HELPERRESET_JUMP2                        0000008B    
KSSU_HELPERRESET_JUMP3                        000000D4    
KSSU_HELPERRESET_JUMP4                        0000010D    
KSSU_HELPERRESET_PATCHES                      0000025B    
KSSU_HELPERRESET_PSG1                         0000016C    
KSSU_HELPERRESET_PSG2                         000001B1    
KSSU_HELPERRESET_PSG3                         000001E8    
KSSU_HELPERRESET_PWM1                         000001FA    
KSSU_HELPERRESET_PWM1_LOOP1                   000001FC    
KSSU_HELPERRESET_PWM2                         00000217    
KSSU_HELPERRESET_PWM2_LOOP1                   0000021A    
KSSU_HELPERRESET_PWM3                         00000232    
KSSU_HELPERRESET_PWM4                         0000024B    NA0                0000008A E
NA1                00000096 E  NA2                000000A2 E  NA3                000000AE E
NA4                000000BA E  NA5                000000C6 E  NA6                000000D2 E
NA7                000000DE E  NAB0               00000089 E  NAB1               00000095 E
NAB2               000000A1 E  NAB3               000000AD E  NAB4               000000B9 E
NAB5               000000C5 E  NAB6               000000D1 E  NAB7               000000DD E
NB0                0000008C E  NB1                00000098 E  NB2                000000A4 E
NB3                000000B0 E  NB4                000000BC E  NB5                000000C8 E
NB6                000000D4 E  NBB0               0000008B E  NBB1               00000097 E
NBB2               000000A3 E  NBB3               000000AF E  NBB4               000000BB E
NBB5               000000C7 E  NBB6               000000D3 E  NBB7               000000DF E
NC0                00000081 E  NC1                0000008D E  NC2                00000099 E
NC3                000000A5 E  NC4                000000B1 E  NC5                000000BD E
NC6                000000C9 E  NC7                000000D5 E  NCS0               00000082 E
NCS1               0000008E E  NCS2               0000009A E  NCS3               000000A6 E
NCS4               000000B2 E  NCS5               000000BE E  NCS6               000000CA E
NCS7               000000D6 E  ND0                00000083 E  ND1                0000008F E
ND2                0000009B E  ND3                000000A7 E  ND4                000000B3 E
ND5                000000BF E  ND6                000000CB E  ND7                000000D7 E
NE0                00000085 E  NE1                00000091 E  NE2                0000009D E
NE3                000000A9 E  NE4                000000B5 E  NE5                000000C1 E
NE6                000000CD E  NE7                000000D9 E  NEB0               00000084 E
NEB1               00000090 E  NEB2               0000009C E  NEB3               000000A8 E
NEB4               000000B4 E  NEB5               000000C0 E  NEB6               000000CC E
NEB7               000000D8 E  NF0                00000086 E  NF1                00000092 E
NF2                0000009E E  NF3                000000AA E  NF4                000000B6 E
NF5                000000C2 E  NF6                000000CE E  NF7                000000DA E
NFS0               00000087 E  NFS1               00000093 E  NFS2               0000009F E
NFS3               000000AB E  NFS4               000000B7 E  NFS5               000000C3 E
NFS6               000000CF E  NFS7               000000DB E  NG0                00000088 E
NG1                00000094 E  NG2                000000A0 E  NG3                000000AC E
NG4                000000B8 E  NG5                000000C4 E  NG6                000000D0 E
NG7                000000DC E  NRST               00000080 E  PAKICK             0000008B E
PANCENTER          000000C0 S  PANCENTRE          000000C0 S  PANLEFT            00000080 S
PANNONE            00000000 S  PANRIGHT           00000040 S  PASNARE            0000008C E
PBELL              0000008D E  PBONGOHI           00000092 E  PBONGOLO           00000093 E
PCLAP              0000008A E  PCLICKHI           00000090 E  PCLICKLO           00000091 E
PCLOSEDHH          00000098 E  PCOWBELL           0000008F E  PCRASHCYMB         00000089 E
PCRA_D81           00000081 E  PCRA_D82           0000008C E  PCRA_D83           00000085 E
PCRA_D84           00000086 E  PCRA_D85           00000087 E  PEHIHAT            00000088 E
PEKICK             00000081 E  PESNARE            00000082 E  PFINGSNAP          0000008E E
PFINGSNAPHI        0000008E E  PFINGSNAPLO        0000009E E  PNEPDADA           0000009D E
POPENHH            00000099 E  PORCHHITHI         0000009F E  PORCHHITLO         000000A1 E
PORCHHITLOWER      000000A2 E  PORCHHITMED        000000A0 E  PRIDEBELL          00000084 E
PSEGA              00000097 E  PSGDELTA           0000000C E  PSGMOD             00000000 E
PSGPITCH           0000000C E  PSGVOI1            00000000 E  PSGVOI2            00000001 E
PSGVOL1            00000003 E  PSGVOL2            00000005 E  PSILENCE           00000096 E
PSPLASHCYMB        00000083 E  PTIMPANIHI         00000094 E  PTIMPANILO         00000095 E
PTOMHI             00000085 E  PTOMLOW            00000087 E  PTOMLOWER          0000009A E
PTOMLOWERER        0000009B E  PTOMLOWEREST       0000009C E  PTOMMID            00000086 E
PWMPITCH           00000000 E  PWMVOL1            000000AA E  PWMVOL2            00000055 E
SMPSED             000000ED E  SMPSEE             000000EE E  SMPSF9             000000F9 E
SMPSMODOFF         000000F4 E  SMPSMODON          000000F1 E  SMPSNOATTACK       000000E7 E
SMPSPITCH00        00000000 E  SMPSPITCH01HI      0000000C E  SMPSPITCH01LO      000000F4 E
SMPSPITCH02HI      00000018 E  SMPSPITCH02LO      000000E8 E  SMPSPITCH03HI      00000024 E
SMPSPITCH03LO      000000DC E  SMPSPITCH04HI      00000030 E  SMPSPITCH04LO      000000D0 E
SMPSPITCH05HI      0000003C E  SMPSPITCH05LO      000000C4 E  SMPSPITCH06HI      00000048 E
SMPSPITCH06LO      000000B8 E  SMPSPITCH07HI      00000054 E  SMPSPITCH07LO      000000AC E
SMPSPITCH08HI      00000060 E  SMPSPITCH08LO      000000A0 E  SMPSPITCH09HI      0000006C E
SMPSPITCH09LO      00000094 E  SMPSPITCH10HI      00000078 E  SMPSPITCH10LO      00000088 E
TARGET             00040000 E
